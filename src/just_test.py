import os
global a, b

class upload:
    def my_params(self):
        global a, b
        X = a
        y = b
        return X, y


    if __name__ == '__main__':
        global a, b
        a = 2
        b = 3
        print("K")
        # from src import app
        # app.run()


# os.system("python app.py")
import os
from flask import Flask, render_template, request
import pefile
from collections import OrderedDict
import glob, sys, os
import matplotlib as mp
import matplotlib.pyplot as plt
import pandas as pd


count = 0

if count == 0:
    print(count)
    count += 1

app = Flask(__name__)

APP_ROOT = os.path.dirname(os.path.abspath(__file__))


def get_files():
    from os import listdir
    from os.path import isfile, join

    mypath = '/home/momo/PycharmProjects/Malware_Analysis/src/images/'

    onlyfiles = [f for f in listdir(mypath) if isfile(join(mypath, f))]
    for f in onlyfiles:
        print(f)


@app.route("/")
def index():
    return render_template("upload.html")

@app.route("/upload", methods=['POST'])
def upload():
    target = os.path.join(APP_ROOT, 'images/')
    # print(target)

    if not os.path.isdir(target):
        os.mkdir(target)

    for file in request.files.getlist("file"):
        # print(file)
        filename = file.filename
        destinaton = "/".join([target, filename])
        # print(destinaton)
        file.save(destinaton)

    get_files()
    print(a, b)

    return 'File uploaded!'
    #return render_template("complete.html")

def run():
    # if __name__ == "__main__": # will always run
    app.run(port=4555)

if __name__ == "__main__":  # will only be run if not imported
    app.run(port=4555)
