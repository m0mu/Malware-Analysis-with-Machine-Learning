import os
from flask import Flask, render_template, request
import pefile
from collections import OrderedDict
import glob, sys, os
import matplotlib as mp
import matplotlib.pyplot as plt
import pandas as pd


class check:
    count = 0

    if count == 0:
        print(count)
        count += 1
    global APP_ROOT, app

    app = Flask(__name__)

    APP_ROOT = os.path.dirname(os.path.abspath(__file__))

    @staticmethod
    def get_files():

        from os import listdir
        from os.path import isfile, join

        mypath = '/home/momo/PycharmProjects/Malware_Analysis/src/images/'

        onlyfiles = [f for f in listdir(mypath) if isfile(join(mypath, f))]
        for f in onlyfiles:
            print(f)

    @staticmethod
    @app.route("/")
    def index():
        return render_template("upload.html")

    @staticmethod
    @app.route("/upload", methods=['POST'])
    def upload():
        target = os.path.join(APP_ROOT, 'images/')
        # print(target)

        if not os.path.isdir(target):
            os.mkdir(target)

        for file in request.files.getlist("file"):
            # print(file)
            filename = file.filename
            destinaton = "/".join([target, filename])
            # print(destinaton)
            file.save(destinaton)

        from src import app
        app.check.get_files()

        return 'File uploaded!'
        #return render_template("complete.html")

    if __name__ == '__main__':
        app.run(port=4555)


    # if __name__ == "__main__":  # will only be run if not imported
    #     app.run(port=4555)